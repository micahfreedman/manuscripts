leaf.data$Species <- revalue(leaf.data$Species, c("Ceanothus_megacarpus" = "Ceanothus", "Cercocarpus_betuloides" = "Cercocarpus", "Dendromecon_harfordii" = "Dendromecon", "Dendromecon_rigida"= "Dendromecon", "Heteromeles_arbutifolia" = "Heteromeles", "Prunus_ilicifolia" = "Prunus"))
leaf.data$Site <- revalue(leaf.data$Site, c("Santa_Cruz" = "Santa Cruz", "Santa_Monicas"="Santa Monicas", "Santa_Rosa" = "Santa Rosa", "Stunt_Ranch" = "Stunt Ranch"))
for( i in 1:nrow(leaf.data))
leaf.data$plant.ID[i] = paste(leaf.data$Species[i], leaf.data$Plant[i], sep="_")
length(unique(leaf.data$plant.ID)) #339 unique plants sampled
leaf.data$Aspect.N = with(leaf.data, ifelse(Aspect == "N", 3,
ifelse(Aspect == "NNW" | Aspect == "NNE", 2,
ifelse(Aspect == "WNW" | Aspect == "ENE", 1,
ifelse(Aspect == "E" | Aspect == "W", 0,
ifelse(Aspect == "ESE" | Aspect == "WSW", -1,
ifelse(Aspect == "SSE" | Aspect == "SSW", -2, -3)))))))
leaf.data$Aspect.E = with(leaf.data, ifelse(Aspect == "E", 3,
ifelse(Aspect == "ENE" | Aspect == "ESE", 2,
ifelse(Aspect == "NNE" | Aspect == "SSE", 1,
ifelse(Aspect == "N" | Aspect == "S", 0,
ifelse(Aspect == "NNW" | Aspect == "SSW", -1,
ifelse(Aspect == "WSW" | Aspect == "WNW", -2, -3)))))))
leaf.data$Aspect.N[is.na(leaf.data$Aspect.N)] <- 0
leaf.data$Aspect.E[is.na(leaf.data$Aspect.E)] <- 0
leaf.data$Stem_Area = with(leaf.data, (Diameter1_.mm.*pi/100) + (Diameter2_.mm.*pi/100))
leaf.data$True_area = (leaf.data$Leaf_Area_no.petiole - leaf.data$Internal_area_correction)
leaf.data$Herbivory = 1 - (1 - (((leaf.data$Leaf_Area_corrected - leaf.data$True_area)/leaf.data$Leaf_Area_corrected) + (leaf.data$Internal_area_correction/leaf.data$True_area)))
hist(leaf.data$Herbivory, breaks = 25)
leaf.data$spines = ifelse(leaf.data$Herbivory > 0.1, NA, (leaf.data$Area_no_spines - leaf.data$Leaf_Area_corrected) / leaf.data$Leaf_Area_corrected * 100)
for( i in 1:nrow(leaf.data))
leaf.data$branch.ID[i] = paste(leaf.data$Species[i], leaf.data$Plant[i], leaf.data$Position[i], sep="_")
length(unique(leaf.data$branch.ID)) #585 unique branches sampled
leaf.data$Site = factor(leaf.data$Site, c("Santa Cruz","Santa Rosa","Catalina","Santa Monicas","Stunt Ranch","Gaviota",'RSA', "SBBG"))
table(leaf.data$X1st_year.) #will get rid of 809 observations
leaf.data <- leaf.data[leaf.data$X1st_year. == 0,]
leaf.data$Source.IM <- ifelse(leaf.data$Source %in% c('Santa Cruz','Santa Rosa','Catalina'), 'Island','Mainland')
head(leaf.data)
leaf.data$Stem_Area_scaled = scale(leaf.data$Stem_Area)
leaf.data$Elevation_scaled = scale(leaf.data$Elevation_.m.)
insitu.leaf.data <- leaf.data[leaf.data$Site %in% c('Catalina','Gaviota','Santa Cruz','Santa Monicas','Santa Rosa','Stunt Ranch'),] #down to 4096 observations
model_leaf_area = lmer(True_area ~ IM + (IM|Species) + Position + (1|Site/plant.ID/branch.ID) + scale(Aspect.N) + scale(Aspect.E) + Elevation_scaled + Stem_Area_scaled, data = insitu.leaf.data) #this model includes the elevation at which plants were sampled and their basal stem area as covariates; elevation doesn't make much sense to include, since it's not really evenly sampled across sites (e.g. all samples from a site typically came from a fairly narrow elevational band); basal stem area is a proxy for the age of the plant, which could potentially be important, especially for island taxa with a history of recent herbivore removal.
summary(model_leaf_area)
model_leaf_area_simple <- lmer(True_area ~ IM + (IM|Species) + Position + scale(Aspect.N) + scale(Aspect.E) + (1|Site/plant.ID/branch.ID), data = insitu.leaf.data)
summary(model_leaf_area_simple) #Calculated degrees of freedom for island/mainland contrast should reflect that analysis is comparing island/mainland status across 5 species x 6 sites, which does appear to be the case. Analysis suggests that, overall, mainland species have smaller leaves, although the difference is not significant. Leaves from the upper portion of the canopy are also somewhat smaller.
newdata <- with(insitu.leaf.data, expand.grid(Species=unique(Species), IM=unique(IM), Aspect.N = mean(Aspect.N), Aspect.E = mean(Aspect.E), Position = unique(Position)))
newdata$predicted.values <- predict(model_leaf_area_simple, newdata, re.form = ~(IM|Species))
(ndag <- aggregate(predicted.values ~ IM + Species, newdata, mean))
randomSims <- REsim(model_leaf_area_simple, n.sims = 500)
plotREsim(randomSims)
for(i in 1:length(unique(insitu.leaf.data$Species))){
spx <- subset(insitu.leaf.data, insitu.leaf.data$Species == unique(insitu.leaf.data$Species)[i])
model_spx <- lmer(True_area ~ IM + Position + (1|Site/plant.ID/branch.ID), data = spx)
print(summary(model_spx)[10])}
model_leaf_area_simple_x <- lmer(True_area ~ IM*Species + Position + scale(Aspect.E) + scale(Aspect.N) + (1|Site/plant.ID/branch.ID), data = insitu.leaf.data)
summary(model_leaf_area_simple_x) #does not return an overall significant island/mainland effect and has much different d.f. calculation for the island/mainland term (this model treats each individual plant as a replicate, rather than the species to which they belong); does enable estimation of marginal means based on the species*IM term
plot.emm.leaf.area <- data.frame(emm.leaf.area[[1]])
ggplot(plot.emm.leaf.area, aes(x = IM, y = emmean, col = IM))+
theme_bw(base_size = 16)+
geom_point(size = 4, pch = 22, aes(fill = IM), col = 'black')+
geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), width = 0.2, size = 1)+
scale_color_manual(values = c('blue','red'))+
scale_fill_manual(values = c('blue','red'))+
facet_wrap(~Species, nrow = 1)+
theme(axis.text.x = element_blank(), axis.title.x = element_blank())+
theme(legend.position = 'bottom', legend.title = element_blank()) #estimated marginal means and confidence intervals for each species*IM combination; these values appear similar to what is shown in the boxplots of raw data. Can see that lower estimate overlaps 0 for Ceanothus, which highlights the issue of using this model format (allows for negative predicted values).
(leaf.area.agg = aggregate( True_area ~ Species + IM + Site + plant.ID, data = insitu.leaf.data, FUN = mean))
ggplot(leaf.area.agg, aes(x=Site, y=True_area))+
geom_boxplot(aes(fill=IM), alpha = 0.3, outlier.color = 'white')+
geom_point(aes(fill=IM), position = position_jitterdodge(0.5), pch = 21)+
facet_wrap(~Species, nrow = 2, scales = 'free')+
theme_bw()+
labs(y = expression ('Leaf Area'~(cm^2)))+
scale_fill_manual(values = c('blue','red'))+
scale_color_manual(values = c('blue','red'))+
theme(axis.text.x = element_text(size=12, angle=60,hjust=1), axis.text.y = element_text(size =12))+
theme(legend.title=element_blank(),legend.text=element_text(size=14),
axis.title.y = element_text(size = 16))+
theme(axis.title.x = element_blank())+
theme(strip.text = element_text(size=16, face = 'italic'))+
theme(legend.position = c(0.8,0.2))
common.gardens <- leaf.data[leaf.data$Site %in% c('RSA','SBBG'),] #759 observations
with(aggregate(True_area ~ plant.ID + Species + Source, mean, data = common.gardens)
, table(Species, Source)) #shows the numbers of plants measured from common gardens, separated by their original place of collection. Noteworthy: no plants from Santa Rosa included in common garden sampling design, and lots of mainland locations that weren't part of original sampling scheme.
with(aggregate(True_area ~ plant.ID + Species + Source.IM, mean, data = common.gardens)
, table(Species, Source.IM))
model_leaf_area_cg <- lmer(True_area ~ Source.IM + (Source.IM|Species) + Position + Site + (1|plant.ID/branch.ID) + Aspect.E + Aspect.N, data = common.gardens) #note: this model does not include a term for the plant's provenance, since there are 13 levels (many of which only have 1 or 2 observations); instead, provenances are pooled into island versus mainland (the Source.IM term).
summary(model_leaf_area_cg) #Mainland plants have modestly smaller leaves, although the difference is not significant
ranef(model_leaf_area_cg)[[3]]
emm.area.cg <- data.frame(emmeans(model_leaf_area_cg, specs = pairwise ~ IM, type = "response"))
emm.area.cg <- data.frame(emmeans(model_leaf_area_cg, specs = pairwise ~ Source.IM, type = "response"))
emmeans(model_leaf_area_cg, specs = pairwise ~ Source.IM, type = "response"))
emmeans(model_leaf_area_cg, specs = pairwise ~ Source.IM, type = "response")
data.frame(emmeans(model_leaf_area_cg, specs = pairwise ~ Source.IM, type = "response"))
emmeans(model_leaf_area_cg, specs = pairwise ~ Source.IM, type = "response"))
emmeans(model_leaf_area_cg, specs = pairwise ~ Source.IM, type = "response")
(10.72-6.79) / 10.72
summary(model_leaf_area_cg) #Mainland plants have modestly smaller leaves, although the difference is not significant
masses <- read.csv(file = './data_files/shrub_leaf_masses.csv', head = T)
for( i in 1:nrow(masses)){
masses$SLA.ID[i] <- paste(masses$Species[i], masses$Number[i], masses$Position[i], sep = "_")
}
for( i in 1:nrow(leaf.data))
leaf.data$SLA.ID[i] = paste(leaf.data$plant.ID[i], leaf.data$Position[i], sep="_")
leaf.data$SLA.ID #looks right
sla.dataframe <- merge(masses[,4:5], leaf.data, by = "SLA.ID")
sla.dataframe$SLA <- sla.dataframe$True_area / sla.dataframe$Mass #create new column for SLA (leaf area divided by tissue mass)
hist(sla.dataframe$SLA) #consider removing values above 25
sla.model <- aggregate(SLA ~ plant.ID + Position + IM + Site + Species + Aspect.N + Aspect.E + Elevation_scaled + Stem_Area_scaled, sla.dataframe[sla.dataframe$SLA < 20,], mean) #need to use aggregate before passing  to model, since for SLA, mass measurements were at the level of branches (sets of leaves) rather than individual leaves
model_specific_leaf_area = lmer(SLA ~ IM + (IM|Species) + Position + (1|Site/plant.ID) + scale(Aspect.N) + scale(Aspect.E), data = sla.model)
summary(model_specific_leaf_area) #Conclusions: no significant difference between island and mainland, though mainland plants tend to have somewhat thicker leaves. Leaves that come from the upper canopy, which are less susceptible to self-shading and have more direct sun exposure, are significantly thicker. Leaves from north facing and west facing slopes tend to be thinner.
(emm.sla <- emmeans(model_specific_leaf_area, specs = pairwise ~ IM, type = "response"))
(6.53 - 5.65) / 6.53
sla.agg <- aggregate(SLA ~ Species + IM + Site + plant.ID, data = sla.dataframe, mean) #now aggregate again, but this time ignore canopy position for the sake of plotting
ggplot(sla.agg[sla.agg$SLA < 20,], aes(x=Site, y=SLA))+
geom_boxplot(aes(fill=IM), alpha = 0.3, outlier.color = 'white')+
geom_point(aes(fill=IM), position = position_jitterdodge(0.5), pch = 21)+
facet_wrap(~Species, nrow = 2, scales = 'free')+
theme_bw()+
labs(y = expression ('Specific Leaf Area'~(cm^2/g)))+
scale_fill_manual(values = c('blue','red'))+
scale_color_manual(values = c('blue','red'))+
theme(axis.text.x = element_text(size=12, angle=60,hjust=1), axis.text.y = element_text(size =12))+
theme(legend.title=element_blank(),legend.text=element_text(size=14),
axis.title.y = element_text(size = 16))+
theme(axis.title.x = element_blank())+
theme(strip.text = element_text(size=16, face = 'italic'))+
theme(legend.position = c(0.8,0.2))
for(i in 1:length(unique(sla.model$Species))){
spx <- subset(sla.model, sla.model$Species == unique(sla.model$Species)[i])
model_spx <- lmer(SLA ~ IM + Position + (1|Site/plant.ID), data = spx)
print(summary(model_spx)[10])}
leaf.data$spines
spine.data <- leaf.data[leaf.data$Species %in% c('Prunus','Heteromeles'),]
hist(spine.data$spines)
spine.data.model <- na.omit(spine.data[!spine.data$Site %in% c('RSA','SBBG'),])
model_leaf_spines = lmer(spines ~ IM*Position + (IM|Species) + (1|Site/plant.ID/branch.ID) + scale(Aspect.N) + scale(Aspect.E), data = spine.data.model) #
summary(model_leaf_spines) #Conclusion: mainland plants are significantly more spiny. Leaves from the upper canopy are less spiny (spinescence heteroblasty), but this pattern is more pronounced on the mainland.
spines.agg <- aggregate(spines ~ Species + Site + IM + plant.ID, data = spine.data.model, mean)
spines.agg
ggplot(spines.agg, aes(x=Site, y=spines))+
geom_boxplot(aes(fill=IM), outlier.color = 'white', alpha = 0.3)+
geom_point(aes(fill=IM), position = position_jitterdodge(0.5), pch = 21)+
facet_wrap(~Species, nrow = 1, scales = 'free')+
theme_bw()+
ylab('Spinescence')+
scale_fill_manual(values = c('blue','red'))+
scale_color_manual(values = c('blue','red'))+
theme(axis.text.x = element_text(size=12, angle=60,hjust=1), axis.text.y = element_text(size =12))+
theme(legend.title=element_blank(),legend.text=element_text(size=14),
axis.title.y = element_text(size = 16))+
theme(axis.title.x = element_blank())+
theme(strip.text = element_text(size=16, face = 'italic'))+
theme(legend.position = 'bottom')
(emm.spines.IM <- emmeans(model_leaf_spines, specs = pairwise ~ IM, type = "response")) #gives ridiculously large confidence intervals for mainland plants
(5.76 - 1.88) / 5.76
summary(model_specific_leaf_area)
emm.sla
emm.spines
emm.spines <- data.frame(emm.spines[[1]])
emm.spines
emm.spines <- data.frame(emm.spines[[2]])
(emm.spines.IM <- emmeans(model_leaf_spines, specs = pairwise ~ IM, type = "response")) #gives ridiculously large confidence intervals for mainland plants
summary(model_leaf_spines)
summary(lmer(spines ~ IM*Position + (1|Site/plant.ID/branch.ID), data = spine.data.model[spine.data.model$Species=='Heteromeles',]))
summary(lmer(spines ~ IM*Position + (1|Site/plant.ID/branch.ID), data = spine.data.model[spine.data.model$Species=='Prunus',]))
spines.common.garden <- spine.data[spine.data$Site %in% c('SBBG','RSA'),] #leaves 314 samples, 24 of which are NAs
spines.common.garden$Source.IM <- ifelse(spines.common.garden$Source %in% c('Santa Rosa','Santa Cruz','Catalina'), 'Island', 'Mainland')
with(aggregate(spines ~ plant.ID + Species + Source.IM, mean, data = spines.common.garden)
, table(Species, Source.IM)) #table showing number of plants sampled for spinescence at common gardens for both Prunus and Heteromeles
model_spines_cg <- lmer(spines ~ Source.IM*Position + (Source.IM|Species) + (1|plant.ID/branch.ID) + Aspect.E + Aspect.N, data = spines.common.garden[!is.na(spines.common.garden$spines),]) #
summary(model_spines_cg)
(emm.spines.cg <- emmeans(model_spines_cg, specs = pairwise ~ Source.IM, type = "response"))
emm.spines.cg <- data.frame(emm.spines.cg[[1]])
ggplot(emm.spines.cg, aes(x = Source.IM, y = emmean, col = Source.IM))+
theme_bw(base_size = 14)+
geom_point(size = 4, pch = 21, aes(fill = Source.IM), col = 'black')+
geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), width = 0.2, size = 1)+
scale_color_manual(values = c('blue','red'))+
scale_fill_manual(values = c('blue','red'))+
ylab('Spinescence')+
theme(legend.position = 'none', axis.title.x = element_blank())+
theme(strip.text = element_text(size=14, face = 'italic'))
summary(lmer(spines ~ Source.IM*Position + (1|plant.ID/branch.ID) + Aspect.E + Aspect.N, data = spines.common.garden[spines.common.garden$Species=="Heteromeles",]))
summary(lmer(spines ~ Source.IM*Position + (1|plant.ID/branch.ID) + Aspect.E + Aspect.N, data = spines.common.garden[spines.common.garden$Species=="Prunus",]))
summary(lmer(spines ~ Source.IM*Position + (1|plant.ID/branch.ID) + Aspect.E + Aspect.N, data = spines.common.garden[spines.common.garden$Species=="Heteromeles",]))
summary(lmer(spines ~ Source.IM*Position + (1|plant.ID/branch.ID) + Aspect.E + Aspect.N, data = spines.common.garden[spines.common.garden$Species=="Prunus",]))
cyanide <- read.csv(file = './data_files/cyanide_measurements.csv', header = T)
head(cyanide)
cyanide$IM <- ifelse(cyanide$Site %in% c('Catalina','Santa Cruz','Santa Rosa'), 'Island', 'Mainland')
cyanide <- na.omit(cyanide[cyanide$Species != 'Cercocarpus',]) #drops 25 measurements, leaving 194 independent measures
insitu_cyanide <- cyanide[!cyanide$Source %in% c('SBBG','RSA'),] #drops another 29 measurements, leaving 165 measures
insitu_cyanide$PlantID <- paste(insitu_cyanide$Species, insitu_cyanide$PlantID, sep = "_")
plot.cyanide <- aggregate(Tissue.Concentration ~ Species + Site + IM + PlantID, mean, data = insitu_cyanide)
plot.cyanide$Site <- factor(plot.cyanide$Site, levels = c('Santa Cruz','Santa Rosa','Catalina','Santa Monicas','Stunt Ranch','Gaviota'))
ggplot(plot.cyanide, aes(x=Site, y=Tissue.Concentration))+
geom_boxplot(aes(fill=IM), outlier.color = 'white', alpha = 0.3)+
geom_point(aes(fill=IM), position = position_jitterdodge(0.5), pch = 21)+
facet_wrap(~Species, nrow = 1, scales = 'free')+
theme_bw()+
ylab('Cyanide Concentration (mg HCN / g)')+
scale_fill_manual(values = c('blue','red'))+
scale_color_manual(values = c('blue','red'))+
theme(axis.text.x = element_text(size=12, angle=60,hjust=1), axis.text.y = element_text(size =12))+
theme(legend.title=element_blank(),legend.text=element_text(size=14),
axis.title.y = element_text(size = 16))+
theme(axis.title.x = element_blank())+
theme(strip.text = element_text(size=16, face = 'italic'))+
theme(legend.position = 'bottom')
model_cyanide = lmer(Tissue.Concentration ~ IM*Age + (IM|Species) + (1|Site/PlantID), data = insitu_cyanide)
summary(model_cyanide) #No significant difference between island and mainland, but younger tissue consistently has higher concentrations
emmeans(model_cyanide, specs = pairwise ~ IM, type = "response")
(2.19 - 1.31) / 2.19
summary(lmer(Tissue.Concentration ~ IM*Age + (1|Site/PlantID), data = insitu_cyanide[insitu_cyanide$Species=='Heteromeles',]))
summary(lmer(Tissue.Concentration ~ IM*Age + (1|Site/PlantID), data = insitu_cyanide[insitu_cyanide$Species=='Prunus',]))
summary(lmer(Tissue.Concentration ~ IM*Age + (IM|Species) + (1|PlantID), data = cyanide[cyanide$Source %in% c('SBBG','RSA'),]))
summary(lmer(Tissue.Concentration ~ IM + Age + (1|PlantID), data = cyanide[cyanide$Species =='Heteromeles' & cyanide$Source %in% c('SBBG','RSA'),]))
summary(lmer(Tissue.Concentration ~ IM + Age + (1|PlantID), data = cyanide[cyanide$Species =='Prunus' & cyanide$Source %in% c('SBBG','RSA'),]))
sbbg_stachys_biomass[sbbg_stachys_biomass$Year==2016,]
nrow(sbbg_stachys_biomass[sbbg_stachys_biomass$Year==2016,])
nrow(sbbg_stachys_biomass[sbbg_stachys_biomass$Year==2017,])
which(is.na((sbbg_stachys_biomass[sbbg_stachys_biomass$Year==2016,]$Cumulative_Mass)))
which(is.na((sbbg_stachys_biomass[sbbg_stachys_biomass$Year==2017,]$Cumulative_Mass)))
emmeans(stbu_model, specs = pairwise ~ IM + Year, type = "response")
summary(stbu_model) #Strong year effects (not surprising given supplemental watering in 2016), and decent island/mainland effect, such that island plants generally had higher biomass
emmeans(stbu_model, specs = pairwise ~ IM + Year, type = "response")
library(emmeans)
(163 - 108.1) / 163
(68.7 - 13.9) / 68.7
163 - 108.1
for(i in 1:length(unique(common.gardens$Species))){
spx <- subset(common.gardens, common.gardens$Species == unique(common.gardens$Species)[i])
model_spx <- lmer(True_area ~ Source.IM + Position + (1|plant.ID/branch.ID), data = spx)
print(summary(model_spx)[10])}
summary(model_leaf_area_cg) #Mainland plants have modestly smaller leaves, although the difference is not significant
model_leaf_area_cg <- lmer(True_area ~ Source.IM + (Source.IM|Species) + Position + Site + (1|plant.ID/branch.ID) + scale(Aspect.E) + scale(Aspect.N), data = common.gardens) #note: this model does not include a term for the plant's provenance, since there are 13 levels (many of which only have 1 or 2 observations); instead, provenances are pooled into island versus mainland (the Source.IM term).
summary(model_leaf_area_cg) #Mainland plants have modestly smaller leaves, although the difference is not significant
ranef(model_leaf_area_cg)[[3]]
agg.com.gar.leaf.area <- do.call(data.frame, aggregate(True_area ~ Source.IM + Species,  function(x) c(mean = mean(x), sd = sd(x)), data = aggregate(True_area ~ Species + Source.IM + Position, mean, data = common.gardens)))
ggplot(agg.com.gar.leaf.area, aes(x = Source.IM, y = True_area.mean))+
geom_point()+
geom_errorbar(aes(ymin = True_area.mean - True_area.sd,
ymax = True_area.mean + True_area.sd), width = 0.2)+
facet_wrap(~Species, nrow = 1)
for(i in 1:length(unique(common.gardens$Species))){
spx <- subset(common.gardens, common.gardens$Species == unique(common.gardens$Species)[i])
model_spx <- lmer(True_area ~ Source.IM + Position + (1|plant.ID/branch.ID), data = spx)
print(summary(model_spx)[10])}
emm.area.cg <- emmeans(model_leaf_area_cg, specs = pairwise ~ Source.IM, type = "response") #pools together all species from the common garden setup
spine.data <- leaf.data[leaf.data$Species %in% c('Prunus','Heteromeles'),]
hist(spine.data$spines)
spine.data.model <- na.omit(spine.data[!spine.data$Site %in% c('RSA','SBBG'),])
model_leaf_spines = lmer(spines ~ IM*Position + (IM|Species) + (1|Site/plant.ID/branch.ID) + scale(Aspect.N) + scale(Aspect.E), data = spine.data.model) #
summary(model_leaf_spines) #Conclusion: mainland plants are significantly more spiny. Leaves from the upper canopy are less spiny (spinescence heteroblasty), but this pattern is more pronounced on the mainland.
spines.agg <- aggregate(spines ~ Species + Site + IM + plant.ID, data = spine.data.model, mean)
spines.agg
ggplot(spines.agg, aes(x=Site, y=spines))+
geom_boxplot(aes(fill=IM), outlier.color = 'white', alpha = 0.3)+
geom_point(aes(fill=IM), position = position_jitterdodge(0.5), pch = 21)+
facet_wrap(~Species, nrow = 1, scales = 'free')+
theme_bw()+
ylab('Spinescence')+
scale_fill_manual(values = c('blue','red'))+
scale_color_manual(values = c('blue','red'))+
theme(axis.text.x = element_text(size=12, angle=60,hjust=1), axis.text.y = element_text(size =12))+
theme(legend.title=element_blank(),legend.text=element_text(size=14),
axis.title.y = element_text(size = 16))+
theme(axis.title.x = element_blank())+
theme(strip.text = element_text(size=16, face = 'italic'))+
theme(legend.position = 'bottom')
summary(lmer(spines ~ IM*Position + (1|Site/plant.ID/branch.ID), data = spine.data.model[spine.data.model$Species=='Heteromeles',]))
summary(model_spines_cg)
model_spines_cg <- lmer(spines ~ Source.IM*Position + (Source.IM|Species) + (1|plant.ID/branch.ID) + scale(Aspect.E) + scale(Aspect.N), data = spines.common.garden[!is.na(spines.common.garden$spines),]) #
summary(model_spines_cg)
summary(lmer(spines ~ Source.IM*Position + (1|plant.ID/branch.ID) + Aspect.E + Aspect.N, data = spines.common.garden[spines.common.garden$Species=="Heteromeles",]))
summary(lmer(spines ~ Source.IM*Position + (1|plant.ID/branch.ID) + Aspect.E + Aspect.N, data = spines.common.garden[spines.common.garden$Species=="Prunus",]))
cyanide <- read.csv(file = './data_files/cyanide_measurements.csv', header = T)
head(cyanide)
cyanide$IM <- ifelse(cyanide$Site %in% c('Catalina','Santa Cruz','Santa Rosa'), 'Island', 'Mainland')
cyanide <- na.omit(cyanide[cyanide$Species != 'Cercocarpus',]) #drops 25 measurements, leaving 194 independent measures
insitu_cyanide <- cyanide[!cyanide$Source %in% c('SBBG','RSA'),] #drops another 29 measurements, leaving 165 measures
insitu_cyanide$PlantID <- paste(insitu_cyanide$Species, insitu_cyanide$PlantID, sep = "_")
plot.cyanide <- aggregate(Tissue.Concentration ~ Species + Site + IM + PlantID, mean, data = insitu_cyanide)
plot.cyanide$Site <- factor(plot.cyanide$Site, levels = c('Santa Cruz','Santa Rosa','Catalina','Santa Monicas','Stunt Ranch','Gaviota'))
ggplot(plot.cyanide, aes(x=Site, y=Tissue.Concentration))+
geom_boxplot(aes(fill=IM), outlier.color = 'white', alpha = 0.3)+
geom_point(aes(fill=IM), position = position_jitterdodge(0.5), pch = 21)+
facet_wrap(~Species, nrow = 1, scales = 'free')+
theme_bw()+
ylab('Cyanide Concentration (mg HCN / g)')+
scale_fill_manual(values = c('blue','red'))+
scale_color_manual(values = c('blue','red'))+
theme(axis.text.x = element_text(size=12, angle=60,hjust=1), axis.text.y = element_text(size =12))+
theme(legend.title=element_blank(),legend.text=element_text(size=14),
axis.title.y = element_text(size = 16))+
theme(axis.title.x = element_blank())+
theme(strip.text = element_text(size=16, face = 'italic'))+
theme(legend.position = 'bottom')
model_cyanide = lmer(Tissue.Concentration ~ IM*Age + (IM|Species) + (1|Site/PlantID), data = insitu_cyanide)
summary(model_cyanide) #No significant difference between island and mainland, but younger tissue consistently has higher concentrations
emm.cyanide <- emmeans(model_cyanide, specs = pairwise ~ IM*Age, type = "response")
emm.cyanide <- data.frame(emm.cyanide[[1]])
ggplot(emm.cyanide, aes(x = Age, y = emmean, group = IM, col = IM))+
theme_bw(base_size = 16)+
geom_point(size = 4, pch = 22, aes(fill = IM), col = 'black')+
geom_line(size = 1)+
geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), width = 0.2, size = 1)+
scale_color_manual(values = c('blue','red'))+
scale_fill_manual(values = c('blue','red'))+
xlab('Tissue Age')+
ylab('Cyanide Concentration (mg HCN / g)')+
theme(legend.position = 'bottom', legend.title = element_blank())+
theme(strip.text = element_text(size=16, face = 'italic'))
summary(lmer(Tissue.Concentration ~ IM*Age + (1|Site/PlantID), data = insitu_cyanide[insitu_cyanide$Species=='Heteromeles',]))
summary(lmer(Tissue.Concentration ~ IM*Age + (1|Site/PlantID), data = insitu_cyanide[insitu_cyanide$Species=='Prunus',]))
summary(lmer(Tissue.Concentration ~ IM*Age + (IM|Species) + (1|PlantID), data = cyanide[cyanide$Source %in% c('SBBG','RSA'),]))
summary(lmer(Tissue.Concentration ~ IM + Age + (1|PlantID), data = cyanide[cyanide$Species =='Heteromeles' & cyanide$Source %in% c('SBBG','RSA'),]))
summary(lmer(Tissue.Concentration ~ IM + Age + (1|PlantID), data = cyanide[cyanide$Species =='Prunus' & cyanide$Source %in% c('SBBG','RSA'),]))
summary(lmer(Tissue.Concentration ~ IM*Age + (IM|Species) + (1|PlantID), data = cyanide[cyanide$Source %in% c('SBBG','RSA'),]))
summary(lmer(Tissue.Concentration ~ IM + Age + (1|PlantID), data = cyanide[cyanide$Species =='Heteromeles' & cyanide$Source %in% c('SBBG','RSA'),]))
summary(lmer(Tissue.Concentration ~ IM + Age + (1|PlantID), data = cyanide[cyanide$Species =='Prunus' & cyanide$Source %in% c('SBBG','RSA'),]))
stachys_standardized
stachys_standardized$Population
stachys_sbbg$Garden
stachys_leaf_vocs$Site
stachys_leaf_vocs[stachys_leaf_vocs$Site == 'SCI',]
nrow(stachys_NMDS)
nrow(nmds.data.scores)
nmds.data.scores$Site
stachys_mainland
stachys_mainland$Site
stachys_standardized$Site
stachys_standardized$Population
stachys_standardized[stachys_standardized$Population=='Santa Cruz',5:ncol(stachys_standardized)]
sci_NMDS<-metaMDS(comm=stachys_standardized[stachys_standardized$Population=='Santa Cruz',5:ncol(stachys_standardized)], distance="bray", k=8, autotransform=F, trymax=2500)
sci_NMDS<-metaMDS(comm=stachys_standardized[stachys_standardized$Population=='Santa Cruz',5:ncol(stachys_standardized)], distance="bray", k=5, autotransform=F, trymax=2500)
sci_NMDS<-metaMDS(comm=stachys_standardized[stachys_standardized$Population=='Santa Cruz',5:ncol(stachys_standardized)], distance="bray", k=4, autotransform=F, trymax=2500)
sci_NMDS<-metaMDS(comm=stachys_standardized[stachys_standardized$Population=='Santa Cruz',5:ncol(stachys_standardized)], distance="bray", k=3, autotransform=F, trymax=2500)
stachys_standardized[stachys_standardized$Population=='Santa Cruz',1:4]
sci.nmds.data.scores <- as.data.frame(cbind((stachys_standardized[stachys_standardized$Population=='Santa Cruz',1:4]),scores(sci_NMDS)))
sci.nmds.data.scores
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, col = Site))+
geom_point()+
scale_color_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(20,21))
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, col = Site))+
geom_point()+
scale_color_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(20,22))
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, col = Site))+
geom_point()+
scale_color_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(21,22))+
theme_bw()
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, col = Site))+
geom_point()+
scale_color_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(20,18))+
theme_bw()
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, col = Site))+
geom_point()+
scale_color_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(20,15))+
theme_bw()
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, col = Site))+
geom_point(size = 4)+
scale_color_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(20,15))+
theme_bw()
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, col = Site))+
geom_point(size = 4)+
scale_color_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(20,15))+
theme_bw(base_size = 16)
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, col = Site))+
geom_point(size = 4)+
scale_color_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(20,15))+
theme_bw(base_size = 16)+
theme(legend.position = 'bottom') #no differentiation between SCI genotpyes grown on Santa Cruz versus on the mainland
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, col = Site))+
geom_point(size = 4)+
scale_color_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(20,15))+
theme_bw(base_size = 16)+
theme(legend.position = 'bottom', legend.title = 'none') #no differentiation between SCI genotpyes grown on Santa Cruz versus on the mainland
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, col = Site))+
geom_point(size = 4)+
scale_color_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(20,15))+
theme_bw(base_size = 16)+
theme(legend.position = 'bottom', legend.title = NULL) #no differentiation between SCI genotpyes grown on Santa Cruz versus on the mainland
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, col = Site))+
geom_point(size = 4)+
scale_color_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(20,15))+
theme_bw(base_size = 16)+
theme(legend.position = 'bottom', legend.title = element_blank()) #no differentiation between SCI genotpyes grown on Santa Cruz versus on the mainland
stachys_NMDS<-metaMDS(comm=stachys_standardized[stachys_standardized$Site=='SBBG',5:ncol(stachys_standardized)], distance="bray", k=8, autotransform=F, trymax=1000) #does not always converge, but sometimes does with as few as 100 iterations
nmds.data.scores <- as.data.frame(cbind((stachys_standardized[stachys_standardized$Site=='SBBG',c(1:4)]),scores(stachys_NMDS)))
ggplot(nmds.data.scores, aes(x = NMDS1, y = NMDS2))+
geom_point(aes(fill = Population), size = 4, pch = 21)+
theme_classic(base_size = 16)+
scale_fill_manual(values = c('darkorange4','orange', 'red','gold', 'blue','darkblue'))
stachys_NMDS<-metaMDS(comm=stachys_standardized[stachys_standardized$Site=='SBBG',5:ncol(stachys_standardized)], distance="bray", k=7, autotransform=F, trymax=1000) #does not always converge, but sometimes does with as few as 100 iterations
stressplot(stachys_NMDS)
nmds.data.scores <- as.data.frame(cbind((stachys_standardized[stachys_standardized$Site=='SBBG',c(1:4)]),scores(stachys_NMDS)))
ggplot(nmds.data.scores, aes(x = NMDS1, y = NMDS2))+
geom_point(aes(fill = Population), size = 4, pch = 21)+
theme_classic(base_size = 16)+
scale_fill_manual(values = c('darkorange4','orange', 'red','gold', 'blue','darkblue'))
stachys_NMDS<-metaMDS(comm=stachys_standardized[stachys_standardized$Site=='SBBG',5:ncol(stachys_standardized)], distance="bray", k=10, autotransform=F, trymax=1000) #does not always converge, but sometimes does with as few as 100 iterations
stressplot(stachys_NMDS)
nmds.data.scores <- as.data.frame(cbind((stachys_standardized[stachys_standardized$Site=='SBBG',c(1:4)]),scores(stachys_NMDS)))
ggplot(nmds.data.scores, aes(x = NMDS1, y = NMDS2))+
geom_point(aes(fill = Population), size = 4, pch = 21)+
theme_classic(base_size = 16)+
scale_fill_manual(values = c('darkorange4','orange', 'red','gold', 'blue','darkblue'))
stachys_NMDS<-metaMDS(comm=stachys_standardized[stachys_standardized$Site=='SBBG',5:ncol(stachys_standardized)], distance="bray", k=8, autotransform=F, trymax=1000) #does not always converge, but sometimes does with as few as 100 iterations
stressplot(stachys_NMDS)
nmds.data.scores <- as.data.frame(cbind((stachys_standardized[stachys_standardized$Site=='SBBG',c(1:4)]),scores(stachys_NMDS)))
pdf('./figures/Fig5b.pdf', height = 4, width = 6)
ggplot(nmds.data.scores, aes(x = NMDS1, y = NMDS2))+
geom_point(aes(fill = Population), size = 4, pch = 21)+
theme_classic(base_size = 16)+
scale_fill_manual(values = c('darkorange4','orange', 'red','gold', 'blue','darkblue'))
pdf('./figures/Fig4b.pdf', height = 4, width = 6)
ggplot(nmds.data.scores, aes(x = NMDS1, y = NMDS2))+
geom_point(aes(fill = Population), size = 4, pch = 21)+
theme_classic(base_size = 16)+
scale_fill_manual(values = c('darkorange4','orange', 'red','gold', 'blue','darkblue'))
dev.off()
stachys_standardized$cumulative <- rowSums(stachys_standardized[,5:ncol(stachys_standardized)])
ggplot(stachys_standardized, aes(x = Population, y = (cumulative)))+
theme_bw(base_size = 16)+
geom_boxplot(aes(fill = Population), alpha = 0.3)+
geom_point(aes(col = Population), position = position_jitterdodge(0.5))+
scale_fill_manual(values = c('darkorange4','orange', 'red','gold', 'blue','darkblue'))+
scale_color_manual(values = c('darkorange4','orange', 'red','gold', 'blue','darkblue'))+
ylab('ln(Cumulative Volatile Content)')+
theme(axis.text.x = element_text(angle = 60, hjust = 1))+
theme(legend.position = 'NULL') #gets the point across, but probably not worth including as a main figure
aliphatics <- cbind(stachys_standardized[,c(1:4)],stachys_standardized[,c(names(stachys_standardized) %in% stachys_vocs_compound_list[stachys_vocs_compound_list$Compound_Class=='aliphatic',]$Header_Compound)])
aromatics <- cbind(stachys_standardized[,c(1:4)],stachys_standardized[,c(names(stachys_standardized) %in% stachys_vocs_compound_list[stachys_vocs_compound_list$Compound_Class=='aromatic',]$Header_Compound)])
monoterpenes <- cbind(stachys_standardized[,c(1:4)],stachys_standardized[,c(names(stachys_standardized) %in% stachys_vocs_compound_list[stachys_vocs_compound_list$Compound_Class=='monoterpene',]$Header_Compound)])
sesquiterpenes <- cbind(stachys_standardized[,c(1:4)],stachys_standardized[,c(names(stachys_standardized) %in% stachys_vocs_compound_list[stachys_vocs_compound_list$Compound_Class=='sesquiterpene',]$Header_Compound)])
unknowns <- cbind(stachys_standardized[,c(1:4)],stachys_standardized[,c(names(stachys_standardized) %in% stachys_vocs_compound_list[stachys_vocs_compound_list$Compound_Class=='unknown',]$Header_Compound)])
aliphatics$cumulative <- rowSums(aliphatics[,5:ncol(aliphatics)])
aromatics$cumulative <- rowSums(aromatics[,5:ncol(aromatics)])
monoterpenes$cumulative <- rowSums(monoterpenes[,5:ncol(monoterpenes)])
sesquiterpenes$cumulative <- rowSums(sesquiterpenes[,5:ncol(sesquiterpenes)])
aliphatics <- cbind(stachys_standardized[stachys_standardized$Site=='SBBG',c(1:4)],stachys_standardized[,c(names(stachys_standardized) %in% stachys_vocs_compound_list[stachys_vocs_compound_list$Compound_Class=='aliphatic',]$Header_Compound)])
aliphatics <- cbind(stachys_standardized[,c(1:4)],stachys_standardized[,c(names(stachys_standardized) %in% stachys_vocs_compound_list[stachys_vocs_compound_list$Compound_Class=='aliphatic',]$Header_Compound)])
aromatics <- cbind(stachys_standardized[,c(1:4)],stachys_standardized[,c(names(stachys_standardized) %in% stachys_vocs_compound_list[stachys_vocs_compound_list$Compound_Class=='aromatic',]$Header_Compound)])
monoterpenes <- cbind(stachys_standardized[,c(1:4)],stachys_standardized[,c(names(stachys_standardized) %in% stachys_vocs_compound_list[stachys_vocs_compound_list$Compound_Class=='monoterpene',]$Header_Compound)])
sesquiterpenes <- cbind(stachys_standardized[,c(1:4)],stachys_standardized[,c(names(stachys_standardized) %in% stachys_vocs_compound_list[stachys_vocs_compound_list$Compound_Class=='sesquiterpene',]$Header_Compound)])
unknowns <- cbind(stachys_standardized[,c(1:4)],stachys_standardized[,c(names(stachys_standardized) %in% stachys_vocs_compound_list[stachys_vocs_compound_list$Compound_Class=='unknown',]$Header_Compound)])
aliphatics$cumulative <- rowSums(aliphatics[,5:ncol(aliphatics)])
aromatics$cumulative <- rowSums(aromatics[,5:ncol(aromatics)])
monoterpenes$cumulative <- rowSums(monoterpenes[,5:ncol(monoterpenes)])
sesquiterpenes$cumulative <- rowSums(sesquiterpenes[,5:ncol(sesquiterpenes)])
unknowns$cumulative <- rowSums(unknowns[,5:ncol(unknowns)])
aggregate(cumulative ~ Population, function(x) c(mean = mean(x), se = sd(x)/sqrt(length(x))), data = aliphatics)
aggregate(cumulative ~ Population, function(x) c(mean = mean(x), se = sd(x)/sqrt(length(x))), data = aromatics)
aggregate(cumulative ~ Population, function(x) c(mean = mean(x), se = sd(x)/sqrt(length(x))), data = monoterpenes)
aggregate(cumulative ~ Population, function(x) c(mean = mean(x), se = sd(x)/sqrt(length(x))), data = sesquiterpenes)
aggregate(cumulative ~ Population, function(x) c(mean = mean(x), se = sd(x)/sqrt(length(x))), data = unknowns)
pdf("./figures/Supplemental_Figures/Figure.Sx.pdf", height = 6, width = 6)
ggplot(nmds.data.scores2, aes(x = NMDS1, y = NMDS2))+
geom_point(aes(fill = Population), size = 4, pch = 21)+
theme_bw(base_size = 16)+
scale_fill_manual(values = c('darkorange4','orange', 'red','gold')) #no obvious separation based on population of origin for mainland samples; instead, all seem to be composed of basically the same subset of compounds
dev.off()
pdf("./figures/Supplemental_Figures/Figure.Sx.pdf", height = 6, width = 6)
ggplot(nmds.data.scores2, aes(x = NMDS1, y = NMDS2))+
geom_point(aes(fill = Population), size = 4, pch = 21)+
theme_bw(base_size = 16)+
scale_fill_manual(values = c('darkorange4','orange', 'red','gold')) #no obvious separation based on population of origin for mainland samples; instead, all seem to be composed of basically the same subset of compounds
dev.off()
pdf("./figures/Supplemental_Figures/Figure.Sx.pdf", height = 6, width = 6)
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, col = Site))+
geom_point(size = 4)+
scale_color_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(20,15))+
theme_bw(base_size = 16)+
theme(legend.position = 'bottom', legend.title = element_blank()) #no differentiation between SCI genotpyes grown on Santa Cruz versus on the mainland
dev.off()
pdf("./figures/Supplemental_Figures/Figure.Sx.pdf", height = 4, width = 4)
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, col = Site))+
geom_point(size = 4)+
scale_color_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(20,15))+
theme_bw(base_size = 16)+
theme(legend.position = 'bottom', legend.title = element_blank()) #no differentiation between SCI genotpyes grown on Santa Cruz versus on the mainland
dev.off()
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, fill = Site))+
geom_point(size = 4)+
scale_fill_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(21,22))+
theme_bw(base_size = 16)+
theme(legend.position = 'bottom', legend.title = element_blank()) #no differentiation between SCI genotpyes grown on Santa Cruz versus on the mainland
pdf("./figures/Supplemental_Figures/Figure.Sx.pdf", height = 4, width = 4)
ggplot(sci.nmds.data.scores, aes(x = NMDS1, y = NMDS2, shape = Site, fill = Site))+
geom_point(size = 4)+
scale_fill_manual(values = c('blue','cyan'))+
scale_shape_manual(values = c(21,22))+
theme_bw(base_size = 16)+
theme(legend.position = 'bottom', legend.title = element_blank()) #no differentiation between SCI genotpyes grown on Santa Cruz versus on the mainland
dev.off()
stachys.dist.mat<-vegdist(stachys_standardized[5:ncol(stachys_standardized)], method='bray')
stachys.dist.mat
stachys_standardized
names(stachys_standardized)
adonis2(stachys.dist.mat ~ SourceIM, data = stachys_standardized, permutations = 999, method = 'bray')
adonis2(stachys.dist.mat ~ Site, data = stachys_standardized, permutations = 999, method = 'bray')
adonis2(stachys.dist.mat ~ Source.IM, data = stachys_standardized, permutations = 999, method = 'bray')
adonis2(stachys.dist.mat ~ SourceIM, data = stachys_standardized, permutations = 999, method = 'bray')
?adonis2
